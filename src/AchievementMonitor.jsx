// src/AchievementMonitor.jsx
import { useEffect } from 'react';

import { useAchievement } from './AchievementContext';

const achievementGifs = {
  'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 1 –Ω–æ—Ç–∞—Ç–∫—É': 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMWhqZGM5c2lmaGZ1bWxmNTRnc3BrendiY2cxc2Nzcm94aDdscm9pbiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1aPuY0iblEJupNGrWL/giphy.gif',
  'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 5 –Ω–æ—Ç–∞—Ç–æ–∫': 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNnVqeTJjdnV0MTF4anlhYjY5b2o0N3Vsa2N4NnpkdXI1MXM4OGtrbyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/VbnUQpnihPSIgIXuZv/giphy.gif',
  'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 10 –Ω–æ—Ç–∞—Ç–æ–∫': 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExYXRkdjB5NDBjOGtuMHhodDNhd2M3NnlydWwyN3Y1ZjMwd2ZrdHF1cSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/JIX9t2j0ZTN9S/giphy.gif',
  'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 50 –Ω–æ—Ç–∞—Ç–æ–∫': 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExNDNoc2VuaHRwMGphOHJubTdnazA3NjhseWdteWswdHdtYWtiZDAxMCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/q6RoNkLlFNjaw/giphy.gif',
  'üìÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ 1 –ø–æ–¥—ñ—é': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcnlwbnVwbWI4ejlrNWhpZDJnNnE0aW16eXB4bzNjc2o5eHY1MjJ3ciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Dmvw3HJNNrch9M3hh3/giphy.gif',
  'üìÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ 10 –ø–æ–¥—ñ–π': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExaGltbHJsdml5YjZyZ2N2ZzF4bGM5ZWlpZ2VoNDIwczVmZGl2aGY0ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ckNIUROAf7Coeq3uBU/giphy.gif',
  'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 1 –¥–µ–Ω—å': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExdHVkenlmeXFrYm0xbWliN3E5N3l2OXk3amhyYXBiOXg2YmF2ZjNwNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ZidtAlFZdjS8S6ZFdj/giphy.gif',
  'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 7 –¥–Ω—ñ–≤': 'https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExdG0yM296Y29uMXd5aGg1cjRycnhndjRhNTdrcnk5cjhtazhmNzI2YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o6EhLOY6YRdS7ttgA/giphy.gif',
  'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 21 –¥–µ–Ω—å': 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeDhncmtpZmp4ZjE5aGUxdXBjNG05eXR1bnRnaGp4cXFndW5tM3dxaCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l378mDT0AhDEo7PMc/giphy.gif',
  'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 7 –¥–Ω—ñ–≤': 'https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2w0enJiODV0MmZlbDNlOHM4NWFyMXhkZmM1ZXRuN2Q3cWo5N2YzbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/69lVo8KuIgeh4MsMQQ/giphy.gif',
  'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 21 –¥–µ–Ω—å': 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExenFhbjYyYXlpbjIwZGtsbWFkOGxkY3g2OHk5YWhkaGNtdjZyeG5vMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/cmr86hIAx8q7aqM4mm/giphy.gif',
  'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 50 –¥–Ω—ñ–≤': ' https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExc2F4ZzR2b2hieXl5Zzg1Y3A1azJzMHh6c2N0dXN3aGZkZWgwcjNhMiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/zw69pUViBZCZW/giphy.gif',
  'üåü –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π –º–∞–ª—é–Ω–æ–∫ –Ω–∞ –¥–æ—à–∫—É –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2w3dXhybnprdnJ4aXhjNmhkYzE5M21ieGRkOWhwY2lvb29rc2JhbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HWLa2UnmEsc2qpYu8f/giphy.gif',
  'üìö –ü—Ä–æ—á–∏—Ç–∞—Ç–∏ 5 –∫–Ω–∏–≥': 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExZGZ6NGNzenN4NDB1bGZ3a2tqbXdreHRzaG1qa3BkZ3BlM2thMmNtbiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/dUsblht9Hs4abHk8aG/giphy.gif',
  'üé¨ –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ 5 —Ñ—ñ–ª—å–º—ñ–≤': 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExams1c3RpZ3Vrcm43MW5rMzIzcW84emZ0ZzJnMTJxMDh2ZDgxaWZzZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7rc0qU6m5hneMsuc/giphy.gif',
  'üåà –ó–±–µ—Ä–µ–≥—Ç–∏ 5 –º—É–¥–±–æ—Ä–¥—ñ–≤': 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExdTBoMXR0MzhrbzJvejByMnk4eWNqbDd0cDY0ZzUxdW8xeG05b3NkMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/XQiJigZpYQ9dKrrEbv/giphy.gif',
  'üåà –ó–±–µ—Ä–µ–≥—Ç–∏ 10 –º—É–¥–±–æ—Ä–¥—ñ–≤': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHowam96NHExcHVocnJydnJ1aXN6dmhkbmw3dHk3YnV6MGlxeDdveiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/fmgzNi0Iv5mDo54iGO/giphy.gif',
  'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 1 –∫—Ä–∞—ó–Ω—É': 'https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExMHpsOWQ0bDh0azE1OWRuaGFrcWttZ2xsN254ZGVpbm92MHgwdjEycyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/m1wjvswTOQJ06HU7xu/giphy.gif',
  'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 5 –∫—Ä–∞—ó–Ω': 'https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExMjU5NmNxN2lrMjZtOXljYTF0eXJlaWU3ODZhNWZuYWJ4bHJkZDNkOSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/uY4CJ1kPx3gxpn9HD5/giphy.gif',
  'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 10 –∫—Ä–∞—ó–Ω': 'https://i.giphy.com/lXC2gmHf2ypUs.webp',
  '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 1 –º—Ä—ñ—é': 'https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExMzF2N2xpcHliZnN5bjN0YTZmNGhwY245cDRueW5sdml6dzF6NDNmaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3orifgZ0nDCRjK6tJm/giphy.gif',
  '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 5 –º—Ä—ñ–π': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExZDhucHd4dHVzdTZ4aDJoYTJpZGhvcHE3dzZkZ2Z0cHAzYWF0MHFqOCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1MTLxzwvOnvmE/giphy.gif',
  '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 10 –º—Ä—ñ–π': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExMjE4eHM4czMybnBmbzA0ODFxeWN0Y2VmdTFzNm1sNHpzdWk1djBoZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/DYH297XiCS2Ck/giphy.gif',
  'üõí –î–æ–¥–∞—Ç–∏ 10 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫': 'https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExYWJzdGU3aTdqMnI3NHMyMG5nNjhtZGxkdG8xNGM4aWFjYmNqdTI3dSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Xz4YOcEBaCdJKHz0I4/giphy.gif',
  'üõí –î–æ–¥–∞—Ç–∏ 25 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫': 'https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXR2YTE3OWttbXQ2b2ZjMWc0NXV6ZmMxYjNzMnRtYzlpNzEwdmtoMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HfGomEn75GwUv105Gv/giphy.gif',
  'üõí –î–æ–¥–∞—Ç–∏ 50 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫': 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExYzV2cXVmM3NuNWo3aGIzZWh3dWRwbzQ1NTNvc2wwZ3d5bXYyZHZzMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s8Sh7b9lB2TOocCFqu/giphy.gif'
};

function AchievementMonitor() {
  const { triggerAchievement } = useAchievement();

  useEffect(() => {
    const interval = setInterval(() => {
      try {
        const notes = JSON.parse(localStorage.getItem('notes')) || [];
        const habits = JSON.parse(localStorage.getItem('habits')) || [];
        const moodHistory = JSON.parse(localStorage.getItem('moodHistory')) || [];
        const calendarEvents = JSON.parse(localStorage.getItem('calendarEvents')) || {};
        const books = JSON.parse(localStorage.getItem('savedBooks')) || [];
        const movies = JSON.parse(localStorage.getItem('savedMovies')) || [];
        const dreams = JSON.parse(localStorage.getItem('dreams')) || [];
        const shopping = JSON.parse(localStorage.getItem('shoppingList')) || [];
        const inspoBoards = JSON.parse(localStorage.getItem('inspo-savedItems')) || [];
        const visitedCountries = JSON.parse(localStorage.getItem('visitedCountries')) || [];

        const totalEvents = Object.values(calendarEvents).flat().length;
        const moodDays = moodHistory.length;
        const completedHabits7 = habits.filter(habit => Object.values(habit.log || {}).filter(Boolean).length >= 7).length;
        const completedHabits21 = habits.filter(habit => Object.values(habit.log || {}).filter(Boolean).length >= 21).length;
        const readBooks = books.filter(b => b.status === 'read').length;
        const watchedMovies = movies.filter(m => m.status === 'watched').length;
        const completedDreams = dreams.filter(d => d.completed).length;

        const achievementsList = [
          { text: 'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 1 –Ω–æ—Ç–∞—Ç–∫—É', current: notes.length, goal: 1 },
          { text: 'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 5 –Ω–æ—Ç–∞—Ç–æ–∫', current: notes.length, goal: 5 },
          { text: 'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 10 –Ω–æ—Ç–∞—Ç–æ–∫', current: notes.length, goal: 10 },
          { text: 'üìì –°—Ç–≤–æ—Ä–∏—Ç–∏ 50 –Ω–æ—Ç–∞—Ç–æ–∫', current: notes.length, goal: 50 },
          { text: 'üìÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ 1 –ø–æ–¥—ñ—é', current: totalEvents, goal: 1 },
          { text: 'üìÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ 10 –ø–æ–¥—ñ–π', current: totalEvents, goal: 10 },
          { text: 'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 1 –¥–µ–Ω—å', current: habits.some(habit => Object.values(habit.log || {}).some(v => v)) ? 1 : 0, goal: 1 },
          { text: 'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 7 –¥–Ω—ñ–≤', current: completedHabits7, goal: 1 },
          { text: 'üéØ –í–∏–∫–æ–Ω–∞—Ç–∏ –∑–≤–∏—á–∫—É 21 –¥–µ–Ω—å', current: completedHabits21, goal: 1 },
          { text: 'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 7 –¥–Ω—ñ–≤', current: moodDays, goal: 7 },
          { text: 'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 21 –¥–µ–Ω—å', current: moodDays, goal: 21 },
          { text: 'üåà –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π 50 –¥–Ω—ñ–≤', current: moodDays, goal: 50 },
          { text: 'üåü –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π –º–∞–ª—é–Ω–æ–∫ –Ω–∞ –¥–æ—à–∫—É –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è', current: inspoBoards.length >= 1 ? 1 : 0, goal: 1 },
          { text: 'üìö –ü—Ä–æ—á–∏—Ç–∞—Ç–∏ 5 –∫–Ω–∏–≥', current: readBooks, goal: 5 },
          { text: 'üé¨ –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ 5 —Ñ—ñ–ª—å–º—ñ–≤', current: watchedMovies, goal: 5 },
          { text: 'üåà –ó–±–µ—Ä–µ–≥—Ç–∏ 5 –º—É–¥–±–æ—Ä–¥—ñ–≤', current: inspoBoards.length, goal: 5 },
          { text: 'üåà –ó–±–µ—Ä–µ–≥—Ç–∏ 10 –º—É–¥–±–æ—Ä–¥—ñ–≤', current: inspoBoards.length, goal: 10 },
          { text: 'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 1 –∫—Ä–∞—ó–Ω—É', current: visitedCountries.length, goal: 1 },
          { text: 'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 5 –∫—Ä–∞—ó–Ω', current: visitedCountries.length, goal: 5 },
          { text: 'üåç –í—ñ–¥–≤—ñ–¥–∞—Ç–∏ 10 –∫—Ä–∞—ó–Ω', current: visitedCountries.length, goal: 10 },
          { text: '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 1 –º—Ä—ñ—é', current: completedDreams, goal: 1 },
          { text: '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 5 –º—Ä—ñ–π', current: completedDreams, goal: 5 },
          { text: '‚úÖ –í–∏–∫–æ–Ω–∞—Ç–∏ 10 –º—Ä—ñ–π', current: completedDreams, goal: 10 },
          { text: 'üõí –î–æ–¥–∞—Ç–∏ 10 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', current: shopping.length, goal: 10 },
          { text: 'üõí –î–æ–¥–∞—Ç–∏ 25 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', current: shopping.length, goal: 25 },
          { text: 'üõí –î–æ–¥–∞—Ç–∏ 50 –±–∞–∂–∞–Ω—å —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', current: shopping.length, goal: 50 },
        ];

        const storedProgress = JSON.parse(localStorage.getItem('achievementsProgress')) || {};

        achievementsList.forEach((a) => {
          const isAlreadyCompleted = storedProgress[a.text];
          const nowDone = a.current >= a.goal;

          if (!isAlreadyCompleted && nowDone) {
            const gifUrl = achievementGifs[a.text] || null;
            triggerAchievement(a.text, gifUrl);
            storedProgress[a.text] = true;
          }
        });

        localStorage.setItem('achievementsProgress', JSON.stringify(storedProgress));
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–æ—Å—è–≥–Ω–µ–Ω—å:', error);
      }
    }, 2000);

    return () => clearInterval(interval);
  }, [triggerAchievement]);

  return null;
}

export default AchievementMonitor;
